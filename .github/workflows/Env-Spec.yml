name: Deploy to Environment

on:
  workflow_dispatch:
    inputs:
      repo_name:
        description: 'Repository name (e.g., owner/repo)'
        required: true
      branch_or_tag:
        description: 'Exact branch or tag to deploy (e.g., main or v1.0.0)'
        required: true
      environment_name:
        description: 'Environment to which the deployment will be applied (e.g., dev, staging, production)'
        required: true

jobs:
  deploy:
    name: Deploy to Specified Repository and Environment
    runs-on: ubuntu-latest

    permissions:
      contents: write
      deployments: write

    steps:
      - name: Validate Inputs
        run: |
          # Validate branch or tag input
          if [[ ! "${{ inputs.branch_or_tag }}" =~ ^[a-zA-Z0-9._/-]+$ ]]; then
            echo "Invalid branch or tag name: ${{ inputs.branch_or_tag }}"
            exit 1
          fi

          # Validate environment name input
          if [[ ! "${{ inputs.environment_name }}" =~ ^[a-zA-Z0-9_-]+$ ]]; then
            echo "Invalid environment name: ${{ inputs.environment_name }}"
            exit 1
          fi

      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          repository: ${{ inputs.repo_name }}
          ref: ${{ inputs.branch_or_tag }} # Ensure itâ€™s an exact branch or tag
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set Up Environment Variables
        run: |
          echo "Setting up environment variables dynamically"
          echo "API_KEY=$API_KEY" >> $GITHUB_ENV
          echo "ENV_NAME=${{ inputs.environment_name }}" >> $GITHUB_ENV
        env:
          API_KEY: ${{ secrets.API_KEY }}

      - name: Deploy to Environment
        run: |
          echo "Deploying to repository: ${{ inputs.repo_name }}"
          echo "Branch or tag: ${{ inputs.branch_or_tag }}"
          echo "Environment: ${{ inputs.environment_name }}"
          # Replace this line with your deployment logic
          echo "Deployment successful for environment: ${{ inputs.environment_name }}"
