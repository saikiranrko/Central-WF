name: Enforce Tag Pattern for Environment Deployments

on:
  deployment

jobs:
  enforce-tag-pattern:
    if: github.event.deployment.environment == 'production'  # Replace with your environment name
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Validate tag pattern
        env:
          TAG_PATTERN: 'v*'  # Replace with your desired tag pattern
          DEPLOYMENT_REF: ${{ github.event.deployment.ref }}
        run: |
          # Check if the deployment ref matches the tag pattern
          if [[ ! "$DEPLOYMENT_REF" =~ $TAG_PATTERN ]]; then
            echo "Deployment ref '$DEPLOYMENT_REF' does not match the required tag pattern '$TAG_PATTERN'"
            exit 1
          fi
          echo "Deployment ref '$DEPLOYMENT_REF' matches the required tag pattern '$TAG_PATTERN'"
